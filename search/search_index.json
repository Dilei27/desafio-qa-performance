{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"BlazeDemo \u2013 Performance K6","text":""},{"location":"#visao-geral","title":"Vis\u00e3o geral","text":"<ul> <li>Projeto de testes de performance em K6 (JavaScript) voltado para validar o fluxo do BlazeDemo.</li> <li>Meta principal: suportar 250 requisi\u00e7\u00f5es por segundo com P90 abaixo de 2s.</li> <li>Execu\u00e7\u00e3o local, via Docker, Docker Compose e GitHub Actions.</li> <li>Relat\u00f3rio HTML gerado automaticamente pelo <code>handleSummary</code> em <code>reports/summary.html</code> usando <code>k6-reporter</code>.</li> </ul>"},{"location":"#objetivo-do-teste-tecnico","title":"Objetivo do teste t\u00e9cnico","text":"<ul> <li>Sustentar 250 req/s de forma est\u00e1vel.</li> <li>Manter P90 &lt; 2s mesmo com cen\u00e1rios autenticados concorrentes.</li> <li>Evidenciar resultado com relat\u00f3rios HTML/JSON versionados na pasta <code>reports</code>.</li> </ul>"},{"location":"#arquitetura-real-do-projeto","title":"Arquitetura real do projeto","text":"<ul> <li><code>tests/load_test.js</code>: 3 cen\u00e1rios simult\u00e2neos (<code>public_load</code>, <code>auth_flow</code>, <code>private_flow</code>) com thresholds por cen\u00e1rio.</li> <li><code>tests/spike_test.js</code>: teste de pico usando est\u00e1gios graduais (20 \u279d 300 VUs).</li> <li><code>scripts/purchase-flow.js</code>: fluxo opcional reutiliz\u00e1vel de compra/performance para o spike.</li> <li><code>scripts/helpers.js</code>: utilit\u00e1rio de pausa aleat\u00f3ria (n\u00e3o acoplado aos testes atuais).</li> <li><code>Dockerfile</code> e <code>docker-compose.yml</code>: empacotam e executam o K6.</li> <li><code>.github/workflows/k6-performance.yml</code>: pipeline CI/CD que instala o K6 e publica artefatos.</li> <li><code>reports/</code>: sa\u00edda autom\u00e1tica <code>summary.html</code> (HTML) e <code>report.json</code> (quando usado <code>--out json</code>).</li> </ul>"},{"location":"#resumo-dos-cenarios-de-carga-testsload_testjs","title":"Resumo dos cen\u00e1rios de carga (<code>tests/load_test.js</code>)","text":"<ul> <li><code>public_load</code>: <code>constant-vus</code> com 250 VUs por 1m, lendo <code>/public/crocodiles/</code> (tag <code>scenario:public</code>).</li> <li><code>auth_flow</code>: <code>constant-vus</code> com 5 VUs por 1m (start 5s), registra usu\u00e1rio e faz login (tag <code>scenario:auth</code>).</li> <li><code>private_flow</code>: <code>constant-vus</code> com 10 VUs por 1m (start 10s), acessa <code>/my/crocodiles/</code> com token (tag <code>scenario:private</code>).</li> </ul>"},{"location":"#thresholds-e-metricas","title":"Thresholds e m\u00e9tricas","text":"<ul> <li><code>success_rate &gt; 0.95</code> consolidado via m\u00e9trica <code>Rate</code>.</li> <li>P\u00fablicos: <code>http_req_failed{scenario:public} &lt; 1%</code> e <code>http_req_duration{scenario:public} p(90) &lt; 2000 ms</code>.</li> <li>Autenticados: <code>http_req_failed{scenario:auth} &lt; 20%</code>, <code>http_req_duration{scenario:auth} p(95) &lt; 2500 ms</code>.</li> <li>Privados: <code>http_req_failed{scenario:private} &lt; 5%</code>, <code>http_req_duration{scenario:private} p(90) &lt; 2000 ms</code>.</li> <li>Falhas e tempos s\u00e3o avaliados por cen\u00e1rio gra\u00e7as \u00e0s tags configuradas.</li> </ul>"},{"location":"#tecnologias-usadas","title":"Tecnologias usadas","text":"<ul> <li>K6 (JavaScript ES modules).</li> <li>k6-reporter para HTML (<code>handleSummary</code>).</li> <li>Docker e Docker Compose.</li> <li>GitHub Actions.</li> </ul>"},{"location":"#como-interpretar-os-relatorios","title":"Como interpretar os relat\u00f3rios","text":"<ul> <li><code>reports/summary.html</code>: vis\u00e3o gr\u00e1fica (lat\u00eancia, throughput, taxas de erro) gerada ao final do teste.</li> <li><code>reports/report.json</code>: export opcional (<code>--out json=...</code>) usado no CI para consulta detalhada.</li> <li>Compare m\u00e9tricas de lat\u00eancia (p90/p95) e <code>http_req_failed</code> com os thresholds declarados; qualquer viola\u00e7\u00e3o quebra o teste.</li> </ul>"},{"location":"ci-cd/","title":"CI/CD","text":""},{"location":"ci-cd/#pipeline-github-actions-githubworkflowsk6-performanceyml","title":"Pipeline GitHub Actions (<code>.github/workflows/k6-performance.yml</code>)","text":"<ul> <li>Acionado em pushes para <code>main</code> e manualmente via <code>workflow_dispatch</code>.</li> <li>Job \u00fanico <code>load-test</code> executa em <code>ubuntu-latest</code>.</li> </ul>"},{"location":"ci-cd/#etapas","title":"Etapas","text":"<ul> <li>Checkout: <code>actions/checkout@v4</code> para obter o c\u00f3digo.</li> <li>Install k6: adiciona reposit\u00f3rio oficial, instala o bin\u00e1rio e valida com <code>k6 version</code>.</li> <li>Run Load Test: cria <code>reports/</code>, executa <code>k6 run tests/load_test.js --out json=reports/report.json</code> (gera tamb\u00e9m <code>reports/summary.html</code> via <code>handleSummary</code>).</li> <li>List Artifacts: lista o conte\u00fado de <code>reports/</code> para confer\u00eancia de CI.</li> <li>Upload Artifacts: publica <code>reports/report.json</code> e <code>reports/summary.html</code> separadamente com <code>actions/upload-artifact@v4</code>.</li> </ul>"},{"location":"ci-cd/#onde-encontrar-os-relatorios","title":"Onde encontrar os relat\u00f3rios","text":"<ul> <li>Ap\u00f3s a execu\u00e7\u00e3o, os artefatos <code>k6-json-report</code> e <code>k6-summary-html</code> ficam dispon\u00edveis na aba \"Actions\" &gt; run do workflow.</li> <li>Localmente no runner (ou ap\u00f3s download do artifact): <code>reports/report.json</code> para an\u00e1lise detalhada e <code>reports/summary.html</code> para visualiza\u00e7\u00e3o gr\u00e1fica.</li> </ul>"},{"location":"docker/","title":"Docker","text":""},{"location":"docker/#dockerfile","title":"Dockerfile","text":"<ul> <li>Base: <code>grafana/k6:latest</code>.</li> <li><code>WORKDIR /app</code> e <code>COPY . .</code> para trazer scripts e testes.</li> <li><code>CMD [\"run\", \"tests/load_test.js\"]</code> mant\u00e9m a execu\u00e7\u00e3o padr\u00e3o do load test.</li> <li>Inclui <code>handleSummary</code>, logo <code>reports/summary.html</code> \u00e9 gerado dentro do cont\u00eainer.</li> </ul>"},{"location":"docker/#docker-composeyml","title":"docker-compose.yml","text":"<ul> <li>Servi\u00e7o \u00fanico <code>k6</code>:</li> <li><code>build: .</code> usa o <code>Dockerfile</code> local.</li> <li><code>container_name: k6-performance-test</code>.</li> <li>Volume <code>.:/app</code> para compartilhar c\u00f3digo e relat\u00f3rios com a m\u00e1quina host.</li> <li>Comando padr\u00e3o: <code>k6 run tests/load_test.js</code>.</li> </ul>"},{"location":"docker/#como-executar","title":"Como executar","text":"<pre><code>docker build -t k6-performance .\ndocker run --rm -v \"$(pwd)\"/reports:/app/reports k6-performance\n</code></pre> <p>Ou com Docker Compose:</p> <pre><code>docker compose up --build\n</code></pre> <ul> <li>Ap\u00f3s a execu\u00e7\u00e3o, consulte <code>reports/summary.html</code> e <code>reports/report.json</code> (se <code>--out</code> for usado) no diret\u00f3rio montado.</li> </ul>"},{"location":"project-structure/","title":"Estrutura do Projeto","text":""},{"location":"project-structure/#arvore-de-pastas-real","title":"\u00c1rvore de pastas real","text":"<pre><code>performance-blazedemo-k6/\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 load_test.js\n\u2502   \u2514\u2500\u2500 spike_test.js\n\u251c\u2500\u2500 scripts/\n\u2502   \u251c\u2500\u2500 purchase-flow.js\n\u2502   \u2514\u2500\u2500 helpers.js\n\u251c\u2500\u2500 reports/\n\u2502   \u2514\u2500\u2500 summary.html        # gerado automaticamente\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 .github/workflows/k6-performance.yml\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 mkdocs.yml\n</code></pre>"},{"location":"project-structure/#descricao-dos-arquivos","title":"Descri\u00e7\u00e3o dos arquivos","text":"<ul> <li><code>tests/load_test.js</code>: teste principal com tr\u00eas cen\u00e1rios concorrentes e thresholds separados.</li> <li><code>tests/spike_test.js</code>: teste de pico usando o fluxo de compra para avaliar resili\u00eancia.</li> <li><code>scripts/purchase-flow.js</code>: fluxo reutiliz\u00e1vel de compra/autentica\u00e7\u00e3o (usado no spike).</li> <li><code>scripts/helpers.js</code>: fun\u00e7\u00e3o utilit\u00e1ria de pausa aleat\u00f3ria (atualmente n\u00e3o importada).</li> <li><code>reports/</code>: sa\u00edda autom\u00e1tica <code>summary.html</code> (HTML) e <code>report.json</code> quando acionado com <code>--out</code>.</li> <li><code>Dockerfile</code>: imagem baseada em <code>grafana/k6:latest</code>, copia o c\u00f3digo e roda <code>tests/load_test.js</code>.</li> <li><code>docker-compose.yml</code>: orquestra o cont\u00eainer K6 com bind mount do diret\u00f3rio do projeto.</li> <li><code>.github/workflows/k6-performance.yml</code>: pipeline CI/CD para executar o load test e publicar artefatos.</li> </ul>"},{"location":"project-structure/#cenarios-do-teste-de-carga","title":"Cen\u00e1rios do teste de carga","text":"<ul> <li><code>public_load</code>: fluxo p\u00fablico de leitura (<code>GET /public/crocodiles/</code>) com 250 VUs est\u00e1veis por 1m.</li> <li><code>auth_flow</code>: registra um usu\u00e1rio e faz login com 5 VUs por 1m (inicia em 5s).</li> <li><code>private_flow</code>: acessa dados privados com token, 10 VUs por 1m (inicia em 10s).</li> <li>Todos os cen\u00e1rios compartilham a m\u00e9trica <code>success_rate</code> para medir sucesso agregado.</li> </ul>"},{"location":"results/","title":"Resultados","text":""},{"location":"results/#resultado-real","title":"Resultado real","text":"<ul> <li>Throughput sustentado: ~1119 req/s durante o teste de carga.</li> <li>Lat\u00eancia: P90 \u2248 165 ms no cen\u00e1rio p\u00fablico (bem abaixo do limite de 2s).</li> <li>Thresholds: todos atendidos (<code>success_rate</code>, <code>http_req_failed</code>, <code>http_req_duration</code> por cen\u00e1rio).</li> <li>Estabilidade: sem quedas de VU ou degrada\u00e7\u00e3o percept\u00edvel ao longo do minuto de execu\u00e7\u00e3o.</li> </ul>"},{"location":"results/#observacao-tecnica-201200","title":"Observa\u00e7\u00e3o t\u00e9cnica (201/200)","text":"<ul> <li>A API demo <code>test-api.k6.io</code> limita cria\u00e7\u00e3o de usu\u00e1rios por IP.</li> <li>Consequ\u00eancias observadas:</li> <li>Algumas chamadas de registro retornam <code>200</code> em vez de <code>201</code>.</li> <li>Falhas intermitentes s\u00e3o toleradas pelos thresholds configurados para fluxos autenticados.</li> <li>N\u00e3o afeta a valida\u00e7\u00e3o do crit\u00e9rio principal (carga p\u00fablica com P90 &lt; 2s).</li> </ul>"},{"location":"results/#conclusao","title":"Conclus\u00e3o","text":"<ul> <li>O objetivo de 250 req/s com P90 &lt; 2s foi atingido com ampla margem.</li> <li>A arquitetura com cen\u00e1rios paralelos, thresholds por tag e relat\u00f3rio HTML permite monitorar rapidamente qualquer regress\u00e3o.</li> <li>Os artefatos <code>reports/summary.html</code> e <code>reports/report.json</code> sustentam a evid\u00eancia de aprova\u00e7\u00e3o.</li> </ul>"},{"location":"setup/","title":"Setup","text":""},{"location":"setup/#requisitos","title":"Requisitos","text":"<ul> <li>k6 instalado localmente (CLI oficial).</li> <li>Docker 20+ e Docker Compose (opcional para execu\u00e7\u00e3o conteinerizada).</li> <li>Acesso \u00e0 internet para baixar depend\u00eancias do K6 e m\u00f3dulos remotos.</li> </ul>"},{"location":"setup/#instalacao-do-k6","title":"Instala\u00e7\u00e3o do K6","text":"<pre><code>sudo apt-get update &amp;&amp; sudo apt-get install -y gnupg curl\ncurl -fsSL https://dl.k6.io/key.gpg | sudo gpg --dearmor -o /usr/share/keyrings/k6-archive-keyring.gpg\necho \"deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main\" | sudo tee /etc/apt/sources.list.d/k6.list\nsudo apt-get update &amp;&amp; sudo apt-get install -y k6\nk6 version\n</code></pre>"},{"location":"setup/#execucao-local","title":"Execu\u00e7\u00e3o local","text":"<pre><code>k6 run tests/load_test.js\n</code></pre> <ul> <li>Gera automaticamente <code>reports/summary.html</code> via <code>handleSummary</code>.</li> <li>Para o spike test:</li> </ul> <pre><code>k6 run tests/spike_test.js\n</code></pre>"},{"location":"setup/#execucao-via-docker","title":"Execu\u00e7\u00e3o via Docker","text":"<pre><code>docker build -t k6-performance .\ndocker run --rm -v \"$(pwd)\"/reports:/app/reports k6-performance\n</code></pre> <ul> <li>O volume garante que <code>reports/summary.html</code> e <code>reports/report.json</code> fiquem dispon\u00edveis na m\u00e1quina host.</li> </ul>"},{"location":"setup/#execucao-via-docker-compose","title":"Execu\u00e7\u00e3o via Docker Compose","text":"<pre><code>docker compose up --build\n</code></pre> <ul> <li>Usa o servi\u00e7o <code>k6</code> definido em <code>docker-compose.yml</code> e executa <code>tests/load_test.js</code>.</li> </ul>"},{"location":"setup/#como-gerar-relatorio-html","title":"Como gerar relat\u00f3rio HTML","text":"<ul> <li>Nenhum passo extra: <code>handleSummary</code> grava <code>reports/summary.html</code> ao fim de cada execu\u00e7\u00e3o.</li> <li>Para abrir localmente:</li> </ul> <pre><code>python -m http.server --directory reports 8000\n# ou apenas abra reports/summary.html no navegador\n</code></pre>"},{"location":"spike-test/","title":"Spike Test","text":""},{"location":"spike-test/#objetivo","title":"Objetivo","text":"<ul> <li>Validar resili\u00eancia a aumentos abruptos de usu\u00e1rios simult\u00e2neos e observar recupera\u00e7\u00e3o controlada.</li> <li>Garantir que lat\u00eancia e taxa de falhas permane\u00e7am dentro dos thresholds mesmo no pico.</li> </ul>"},{"location":"spike-test/#estagios-definidos-testsspike_testjs","title":"Est\u00e1gios definidos (<code>tests/spike_test.js</code>)","text":"<pre><code>{ duration: \"10s\", target: 20 }   // rampa inicial\n{ duration: \"5s\",  target: 300 }  // spike forte\n{ duration: \"10s\", target: 300 }  // sustenta\u00e7\u00e3o do pico\n{ duration: \"10s\", target: 0 }    // rampa de sa\u00edda\n</code></pre> <ul> <li>Thresholds globais: <code>http_req_failed &lt; 5%</code> e <code>http_req_duration p(90) &lt; 2000 ms</code>.</li> <li>Fluxo executado: <code>performanceFlow</code> (<code>scripts/purchase-flow.js</code>) com registro, login e consulta autenticada.</li> </ul>"},{"location":"spike-test/#como-rodar","title":"Como rodar","text":"<pre><code>k6 run tests/spike_test.js\n</code></pre> <ul> <li>O <code>handleSummary</code> do K6 n\u00e3o \u00e9 customizado aqui; use <code>--out json=reports/report.json</code> se precisar de export adicional.</li> </ul>"},{"location":"spike-test/#como-validar-resiliencia","title":"Como validar resili\u00eancia","text":"<ul> <li>Monitore picos de <code>http_req_duration</code> (p90/p95) e <code>http_req_failed</code> durante o est\u00e1gio de 300 VUs.</li> <li>Avalie a queda controlada na etapa final (target 0) verificando se n\u00e3o h\u00e1 backlog ou erros acumulados.</li> <li>Compare com os thresholds para confirmar aprova\u00e7\u00e3o autom\u00e1tica.</li> </ul>"},{"location":"tests/","title":"Testes","text":""},{"location":"tests/#load-test-testsload_testjs","title":"Load Test (<code>tests/load_test.js</code>)","text":"<ul> <li>Tr\u00eas cen\u00e1rios <code>constant-vus</code> executam em paralelo durante 1 minuto.</li> <li>VUs: p\u00fablico 250 (imediato), auth 5 (start 5s), privado 10 (start 10s).</li> <li>Objetivo: sustentar 250 req/s com P90 &lt; 2s no cen\u00e1rio p\u00fablico sem degradar fluxos autenticados.</li> <li>Thresholds s\u00e3o aplicados por cen\u00e1rio usando tags (<code>scenario:public|auth|private</code>).</li> </ul>"},{"location":"tests/#fluxos","title":"Fluxos","text":"<ul> <li>publicFlow: <code>GET https://test-api.k6.io/public/crocodiles/</code>, valida <code>200</code>.</li> <li>authFlow: registra usu\u00e1rio (<code>201</code>) e faz login (<code>200</code>), simula autentica\u00e7\u00e3o leve.</li> <li>privateFlow: registra, loga e consulta <code>/my/crocodiles/</code> com token Bearer, espera <code>200</code>.</li> </ul>"},{"location":"tests/#metrica-successrate","title":"M\u00e9trica <code>successRate</code>","text":"<ul> <li><code>successRate</code> \u00e9 um <code>Rate</code> customizado que recebe <code>1</code> para respostas com status esperado e <code>0</code> para falhas.</li> <li>Permite um threshold global <code>rate&gt;0.95</code>, cobrindo todos os fluxos.</li> </ul>"},{"location":"tests/#trechos-importantes","title":"Trechos importantes","text":"<pre><code>export const options = {\n  scenarios: {\n    public_load: { executor: \"constant-vus\", exec: \"publicFlow\", vus: 250, duration: \"1m\", tags: { scenario: \"public\" } },\n    auth_flow:   { executor: \"constant-vus\", exec: \"authFlow\",   vus: 5,   duration: \"1m\", startTime: \"5s\",  tags: { scenario: \"auth\" } },\n    private_flow:{ executor: \"constant-vus\", exec: \"privateFlow\",vus: 10,  duration: \"1m\", startTime: \"10s\", tags: { scenario: \"private\" } },\n  },\n  thresholds: {\n    \"success_rate\": [\"rate&gt;0.95\"],\n    \"http_req_failed{scenario:public}\": [\"rate&lt;0.01\"],\n    \"http_req_duration{scenario:public}\": [\"p(90)&lt;2000\"],\n    \"http_req_failed{scenario:auth}\": [\"rate&lt;0.20\"],\n    \"http_req_duration{scenario:auth}\": [\"p(95)&lt;2500\"],\n    \"http_req_failed{scenario:private}\": [\"rate&lt;0.05\"],\n    \"http_req_duration{scenario:private}\": [\"p(90)&lt;2000\"],\n  },\n};\n</code></pre> <ul> <li>Cada cen\u00e1rio tem <code>check</code> dedicado e incrementa <code>successRate</code> apenas quando o status esperado \u00e9 recebido.</li> </ul>"},{"location":"tests/#handlesummary","title":"<code>handleSummary</code>","text":"<ul> <li>Importa <code>htmlReport</code> de <code>k6-reporter</code> e grava automaticamente em <code>reports/summary.html</code>.</li> <li>Mant\u00e9m o relat\u00f3rio HTML mesmo quando a execu\u00e7\u00e3o ocorre dentro de cont\u00eainer ou CI.</li> </ul> <pre><code>export function handleSummary(data) {\n  return { \"reports/summary.html\": htmlReport(data) };\n}\n</code></pre>"},{"location":"tests/#spike-test-testsspike_testjs","title":"Spike Test (<code>tests/spike_test.js</code>)","text":"<ul> <li>Usa <code>performanceFlow</code> do <code>scripts/purchase-flow.js</code> para simular registro, login e acesso privado.</li> <li>Est\u00e1gios: <code>10s</code> \u2192 20 VUs, <code>5s</code> \u2192 300 VUs (spike), <code>10s</code> mantendo 300, <code>10s</code> descendo para 0.</li> <li>Thresholds globais: <code>http_req_failed &lt; 5%</code> e <code>http_req_duration p(90) &lt; 2000 ms</code>.</li> <li>Objetivo: avaliar resili\u00eancia a crescimento abrupto de carga e recupera\u00e7\u00e3o sem erros persistentes.</li> </ul>"}]}